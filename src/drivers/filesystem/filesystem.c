#include <util/defs.h>
#include "filesystem.h"

lock_t filesystems_lock;
list_entry_t filesystems = INIT_LIST_ENTRY(filesystems);

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// File system implementation
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

error_t fs_open(filesystem_t* self, const char* file, file_open_mode_t mode, file_t** handle) {
    ASSERT(self->open != NULL);
    return self->open(self, file, mode, handle);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// File implementation
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

error_t file_read(file_t* self, size_t offset, void* buffer, size_t size) {
    ASSERT(self->read != NULL);
    return self->read(self, offset, buffer, size);
}

error_t file_close(file_t* self) {
    ASSERT(self->close != NULL);
    return self->close(self);
}
